<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}MainDug{% endblock %}</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='images/logo.svg') }}">
    
    <style>
        /* [INÍCIO DO CSS] */
        /* Todo o código CSS do seu prototype.html deve vir aqui. */
        :root {
            /* Fallbacks */
            --primary-color: #0d6efd;
            --primary-color-rgb: 13, 110, 253;
            --page-bg: #f8f9fa;
            --card-bg: #ffffff;
            --input-bg: #ffffff;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --custom-border-color: #dee2e6;
            --table-striped-bg: #f2f2f2;
            --table-hover-bg: #e9ecef;
            
            /* Raio de borda moderno */
            --border-radius-lg: 0.75rem; /* 12px */
            --border-radius-md: 0.5rem;  /* 8px */
            
            /* Sombra sutil */
            --subtle-shadow: 0 4px 12px rgba(0, 0, 0, 0.04);
        }
        
        :root[data-bs-theme="dark"] {
             --subtle-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        body {
            background-color: var(--page-bg);
            color: var(--text-primary);
            transition: background-color 0.2s ease, color 0.2s ease;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            font-weight: 400;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        h1, h2, h3, h4, h5, h6 {
            font-weight: 600;
            color: var(--text-primary);
        }

        .navbar {
            background-color: var(--card-bg) !important;
            border-bottom: 1px solid var(--custom-border-color);
            transition: background-color 0.2s ease, border-color 0.2s ease;
        }

        .accordion-item{
            margin-bottom: 10px;
        }

        .accordion-header{
            margin-bottom: 10px;
        }
        
        .offcanvas, .modal-content, .auth-container, .stat-card, .accordion-item, .content-box {
            background-color: var(--card-bg) !important;
            color: var(--text-primary) !important;
            border: 1px solid var(--custom-border-color);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--subtle-shadow);
            transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
        }
        
        /* MUDANÇA: Classe de conteúdo genérica (para "Minha Conta") */
        .content-box {
            padding: 2.5rem;
        }
        
        .offcanvas-header, .modal-header, .accordion-header {
            border-bottom: 1px solid var(--custom-border-color);
        }
        .modal-footer {
             border-top: 1px solid var(--custom-border-color);
        }
        
        .btn-close {
            filter: var(--bs-btn-close-white-filter);
        }

        .page { display: block; } /* REMOVIDO: display: none; para as páginas */

        /* MUDANÇA: Auth container centralizado e com max-width */
        .auth-container {
            padding: 2.5rem;
            max-width: 480px;
            margin-left: auto;
            margin-right: auto;
        }

        .form-control, .form-select {
            background-color: var(--input-bg);
            border: 1px solid var(--custom-border-color);
            color: var(--text-primary);
            transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease, box-shadow 0.1s ease;
            border-radius: var(--border-radius-md);
            padding: 0.65rem 1rem;
        }
        
        .form-control[readonly] {
            background-color: var(--page-bg);
        }

        .form-control::placeholder {
            color: var(--text-secondary);
        }

        .form-label {
            color: var(--text-secondary);
            font-weight: 500;
            margin-bottom: 0.25rem;
        }
        .form-control-color {
            width: 100%;
            height: 48px;
            padding: .375rem;
        }
        
        /* NOVO: Wrapper para qualquer input com ícone interno */
        .password-wrapper {
            position: relative;
        }

        .password-wrapper .form-control {
            border-top-right-radius: var(--border-radius-md) !important;
            border-bottom-right-radius: var(--border-radius-md) !important;
            /* Adiciona padding à direita para não sobrepor o texto com o ícone */
            padding-right: 2.5rem; 
        }

        .password-wrapper .toggle-password {
            position: absolute;
            right: 0.9rem; /* 10% less than 1rem */
            top: 50%;
            transform: translateY(-50%); /* Centraliza verticalmente */
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            z-index: 5;
        }
        /* Ajuste para input-group-text (ícones de login) */
        .input-group-text {
             background-color: var(--input-bg);
             border-color: var(--custom-border-color);
             border-right: none;
             border-radius: var(--border-radius-md) 0 0 var(--border-radius-md);
             color: var(--text-secondary);
        }
        .input-group > .form-control {
            border-left: none;
        }
        .input-group.password-wrapper {
            flex-wrap: nowrap; 
        }
        .input-group:not(.password-wrapper) > .form-control {
            border-radius: 0 var(--border-radius-md) var(--border-radius-md) 0;
        }
        .input-group.password-wrapper > .form-control {
             border-radius: 0 var(--border-radius-md) var(--border-radius-md) 0;
        }

        /* NOVO: Correção para input-group com ícone à direita (como a busca) */
        .input-group > .form-control:not(:last-child) {
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }
        .input-group > .input-group-text:last-child {
            border-left: none;
            border-right: 1px solid var(--custom-border-color);
            border-radius: 0 var(--border-radius-md) var(--border-radius-md) 0;
        }
        .input-group > .form-control:not(:first-child) {
            border-left: none;
        }

        /* --- Componente de Imagem (Circular) --- */
        .image-input-preview {
            border: 2px dashed var(--custom-border-color);
            background-color: var(--input-bg);
            color: var(--text-secondary);
            transition: background-color 0.2s ease, border-color 0.2s ease;
            width: 135px; /* 10% less than 150px */
            height: 135px; /* 10% less than 150px */
            border-radius: 50%;
            overflow: hidden;
            cursor: pointer;
            position: relative;
        }
        .image-input-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .image-input-preview .image-input-placeholder {
            color: var(--text-secondary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
        }
        .image-input-preview img[src=""], .image-input-preview img:not([src]) {
            display: none;
        }
        .image-input-preview img[src]:not([src=""]) + .image-input-placeholder {
             display: none;
        }

        /* --- Dashboard --- */
        .stat-card {
             padding: 1.35rem; /* 10% less than 1.5rem */
        }
        .stat-card h5 {
             font-weight: 500;
        }
        .stat-card .stat-value {
             font-weight: 700;
        }
        
        .table {
            --bs-table-bg: transparent;
            --bs-table-striped-bg: var(--table-striped-bg);
            --bs-table-color: var(--text-primary);
            --bs-table-border-color: var(--custom-border-color);
            --bs-table-hover-bg: transparent;
            border-color: var(--custom-border-color);
            border-collapse: collapse;
            width: 100%;
        }
        .table thead {
            border-bottom: 2px solid var(--custom-border-color);
        }
        .table th {
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 0.5px;
        }
        
        /* MUDANÇA: Tabela com ordenação */
        .table th a {
            color: var(--text-secondary);
            text-decoration: none;
            transition: color 0.2s ease;
        }
        .table th a:hover {
            color: var(--primary-color);
        }
        .table th a i {
            font-size: 0.7rem;
            margin-left: 4px;
        }
        
        .table td, .table th {
             padding: 0.9rem 0.675rem; /* 10% less */
             border-bottom: 1px solid var(--custom-border-color);
             border-top: none;
             vertical-align: middle;
        }
        .table tbody tr:last-child td {
             border-bottom: none;
        }
        
        /* MUDANÇA: Badge sutil para flags */
        .badge.bg-flag {
            --bs-bg-opacity: 1;
            background-color: rgba(var(--primary-color-rgb), 0.1);
            color: var(--primary-color);
            font-weight: 500;
        }
        :root[data-bs-theme="dark"] .badge.bg-flag {
            background-color: rgba(var(--primary-color-rgb), 0.2);
        }
        
        /* MUDANÇA: Estilo para carrossel de flags */
        .flag-filter-scroll {
            display: flex;
            overflow-x: auto;
            white-space: nowrap;
            padding-bottom: 9px; /* 10% less than 10px */
            margin-bottom: 1rem;
            /* Esconde a scrollbar visualmente */
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        .flag-filter-scroll::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }
        .flag-filter-scroll .btn {
            margin-right: 0.45rem; /* 10% less than 0.5rem */
        }
        
        .btn {
            border-radius: var(--border-radius-md);
            padding: 0.54rem 1.125rem; /* 10% less */
            font-weight: 500;
            transition: filter 0.2s ease, background-color 0.2s ease, border-color 0.2s ease;
        }
        .btn-sm {
            padding: 0.225rem 0.54rem; /* 10% less */
            border-radius: 6px;
        }
        .btn-xs { /* MUDANÇA: Botão extra pequeno para flags */
            padding: 0.2rem 0.5rem;
            font-size: 0.8rem;
            border-radius: 6px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: hsl(var(--primary-hue), calc(var(--primary-sat) * 0.5), 15%); 
        }
        :root[data-bs-theme="dark"] .btn-primary {
             color: hsl(var(--primary-hue), calc(var(--primary-sat) * 0.5), 95%);
        }
        
        .btn-primary:hover {
            filter: brightness(0.9);
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        .btn-outline-primary {
            color: var(--primary-color);
            border-color: var(--primary-color);
        }
        .btn-outline-primary:hover {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: var(--card-bg);
        }
        .form-check-input:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        a, .btn-link {
            color: var(--primary-color);
            font-weight: 500;
        }
        .navbar-brand {
             font-weight: 700;
        }
        .navbar-brand img {
            height: 30px;
        }
        .badge.bg-primary {
             background-color: var(--primary-color) !important;
        }

        .form-control:focus,
        .form-select:focus,
        .form-check-input:focus {
            border-color: var(--primary-color);
            border-width: 2px;
            box-shadow: none;
            padding: calc(0.585rem - 1px) calc(0.9rem - 1px); /* 10% less */
        }
        .btn:focus, .btn:active {
            box-shadow: 0 0 0 0.25rem rgba(var(--primary-color-rgb), 0.25);
        }

        /* --- Animação do Menu Hambúrguer --- */
        .navbar .navbar-toggler { /* Seletor mais específico para não afetar outros botões */
            border: none;
            padding: 0;
        }
        .navbar .navbar-toggler:focus {
            box-shadow: none;
        }

        .navbar-toggler-icon {
            width: 25.2px; /* 10% less than 28px */
            height: 19.8px; /* 10% less than 22px */
            position: relative;
            transform: rotate(0deg);
            transition: .5s ease-in-out;
            cursor: pointer;
            display: block; /* Ensure it takes up space */
        }

        .navbar-toggler-icon span {
            display: block;
            position: absolute;
            height: 3px;
            width: 90%; /* 10% less than 100% */
            background: var(--text-primary);
            border-radius: 3px;
            left: 0;
            transform: rotate(0deg);
            transition: .25s ease-in-out;
        }
        
        .navbar-toggler-icon span:nth-child(1) { top: 0px; }
        .navbar-toggler-icon span:nth-child(2) { top: 9px; opacity: 1; } /* Ensure opacity is 1 by default */
        .navbar-toggler-icon span:nth-child(3) { top: 18px; }

        /* Quando o menu está aberto, o Bootstrap remove a classe .collapsed do toggler */
        .navbar .navbar-toggler:not(.collapsed) .navbar-toggler-icon span:nth-child(1) { top: 9px; transform: rotate(135deg); }
        .navbar .navbar-toggler:not(.collapsed) .navbar-toggler-icon span:nth-child(2) { opacity: 0; left: -60px; }
        .navbar .navbar-toggler:not(.collapsed) .navbar-toggler-icon span:nth-child(3) { top: 9px; transform: rotate(-135deg); }
        /* [FIM DO CSS] */
    </style>

    <script>
        /* [INÍCIO DO SCRIPT DE TEMA (HEAD)] */
        (function() {
            const root = document.documentElement;
            const THEME_KEY = 'theme';
            const COLOR_KEY = 'primaryColor';

            // 1. Definir Tema (Claro/Escuro)
            let preferredTheme = localStorage.getItem(THEME_KEY);
            if (!preferredTheme) {
                const osPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                preferredTheme = osPrefersDark ? 'dark' : 'light';
            }
            root.setAttribute('data-bs-theme', preferredTheme);
            
            // 2. Funções Helper de Cor
            function hexToRgb(hex) {
                let r = 0, g = 0, b = 0;
                if (hex.length == 4) { // #f03
                    r = parseInt(hex[1] + hex[1], 16);
                    g = parseInt(hex[2] + hex[2], 16);
                    b = parseInt(hex[3] + hex[3], 16);
                } else if (hex.length == 7) { // #ff0033
                    r = parseInt(hex.substring(1, 3), 16);
                    g = parseInt(hex.substring(3, 5), 16);
                    b = parseInt(hex.substring(5, 7), 16);
                }
                return `${r}, ${g}, ${b}`;
            }

            function hexToHsl(hex) {
                let r = 0, g = 0, b = 0;
                if (hex.length == 4) {
                    r = parseInt(hex[1] + hex[1], 16);
                    g = parseInt(hex[2] + hex[2], 16);
                    b = parseInt(hex[3] + hex[3], 16);
                } else if (hex.length == 7) {
                    r = parseInt(hex.substring(1, 3), 16);
                    g = parseInt(hex.substring(3, 5), 16);
                    b = parseInt(hex.substring(5, 7), 16);
                }
                r /= 255; g /= 255; b /= 255;
                let max = Math.max(r, g, b), min = Math.min(r, g, b);
                let h, s, l = (max + min) / 2;
                if (max == min) {
                    h = s = 0; // grayscale
                } else {
                    let d = max - min;
                    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                    switch (max) {
                        case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                        case g: h = (b - r) / d + 2; break;
                        case b: h = (r - g) / d + 4; break;
                    }
                    h /= 6;
                }
                // Retorna H (0-360), S (0-100), L (0-100)
                return [Math.round(h * 360), Math.round(s * 100), Math.round(l * 100)];
            }

            // 3. Função Principal de Aplicação de Cores
            function applyAppTheme(hexColor, theme) {
                const [h, s, l] = hexToHsl(hexColor);
                const rgb = hexToRgb(hexColor);

                // Define as propriedades da COR DE DESTAQUE
                root.style.setProperty('--primary-color', hexColor);
                root.style.setProperty('--primary-color-rgb', rgb);
                root.style.setProperty('--primary-hue', h); // Salva para o CSS usar
                root.style.setProperty('--primary-sat', s + '%'); // Salva para o CSS usar

                // Define as propriedades da PALETA DE FUNDO/TEXTO
                const bgSat = s * 0.15; // Saturação baixa para fundos/textos
                const borderSat = s * 0.2; // Saturação um pouco maior para bordas

                if (theme === 'dark') {
                    root.style.setProperty('--page-bg', `hsl(${h}, ${bgSat}%, 10%)`);
                    root.style.setProperty('--card-bg', `hsl(${h}, ${bgSat}%, 15%)`);
                    root.style.setProperty('--input-bg', `hsl(${h}, ${bgSat}%, 12%)`);
                    root.style.setProperty('--custom-border-color', `hsl(${h}, ${borderSat}%, 25%)`);
                    root.style.setProperty('--text-primary', `hsl(${h}, ${bgSat}%, 95%)`);
                    root.style.setProperty('--text-secondary', `hsl(${h}, ${bgSat}%, 65%)`);
                    root.style.setProperty('--table-striped-bg', `hsl(${h}, ${bgSat}%, 18%)`);
                    root.style.setProperty('--table-hover-bg', `hsl(${h}, ${bgSat}%, 20%)`);

                } else { // light
                    root.style.setProperty('--page-bg', `hsl(${h}, ${bgSat}%, 98%)`);
                    root.style.setProperty('--card-bg', `#ffffff`);
                    root.style.setProperty('--input-bg', `#ffffff`);
                    root.style.setProperty('--custom-border-color', `hsl(${h}, ${borderSat}%, 85%)`);
                    root.style.setProperty('--text-primary', `hsl(${h}, ${bgSat}%, 13%)`);
                    root.style.setProperty('--text-secondary', `hsl(${h}, ${bgSat}%, 45%)`);
                    root.style.setProperty('--table-striped-bg', `hsl(${h}, ${bgSat}%, 95%)`);
                    root.style.setProperty('--table-hover-bg', `hsl(${h}, ${bgSat}%, 90%)`);
                }
            }

            // 4. Aplica Cor Salva
            let preferredColor = localStorage.getItem(COLOR_KEY) || '#0d6efd';
            applyAppTheme(preferredColor, preferredTheme);

            // Exporta a função para ser usada no JS principal (opcional)
            window.applyAppTheme = applyAppTheme;
        })();
        /* [FIM DO SCRIPT DE TEMA (HEAD)] */
    </script>
</head>

<body class="min-vh-100">

    <nav class="navbar navbar-expand-lg sticky-top">
        <div class="container-fluid container">
            <a class="navbar-brand" href="{{ url_for('index') }}">
                <img src="{{ url_for('static', filename='images/logo.svg') }}" alt="MainDug Logo" class="me-2">
                MainDug
            </a>
            <button class="navbar-toggler collapsed" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon">
                    <span></span>
                    <span></span>
                    <span></span>
                </span>
            </button>
            <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
                <div class="offcanvas-header">
                    <h5 class="offcanvas-title" id="offcanvasNavbarLabel">Menu</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body">
                    <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                        {% if current_user.is_authenticated %}
                        
                            <li class="nav-item d-lg-none" id="nav-username">
                                <span class="nav-link disabled fw-bold">Olá, {{ current_user.login }}!</span>
                            </li>
                            <li class="nav-item d-lg-none"><hr></li>
                            
                            <li class="nav-item" id="nav-user-dashboard">
                                <a class="nav-link active" aria-current="page" href="{{ url_for('index') }}"><i class="bi bi-speedometer2"></i> Dashboard</a>
                            </li>
                            <li class="nav-item" id="nav-user-stats">
                                <a class="nav-link" href="{{ url_for('stats') }}"><i class="bi bi-bar-chart-fill"></i> Estatísticas</a>
                            </li>
                            <li class="nav-item" id="nav-user-account">
                                <a class="nav-link" href="{{ url_for('account') }}"><i class="bi bi-person-circle"></i> Minha Conta</a>
                            </li>
                            
                            <li class="nav-item dropdown d-none d-lg-block">
                                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="bi bi-person-circle"></i> {{ current_user.login }}
                                </a>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><a class="dropdown-item" href="{{ url_for('account') }}">Minha Conta</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="{{ url_for('logout') }}"><i class="bi bi-box-arrow-right"></i> Sair</a></li>
                                </ul>
                            </li>
                            
                        {% else %}
                            <li class="nav-item" id="nav-guest-login">
                                <a class="nav-link" href="{{ url_for('login') }}"><i class="bi bi-box-arrow-in-right"></i> Entrar</a>
                            </li>
                            <li class="nav-item" id="nav-guest-register">
                                <a class="nav-link" href="{{ url_for('signup') }}"><i class="bi bi-person-plus-fill"></i> Registrar</a>
                            </li>
                        {% endif %}
                        
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="theme-switcher">
                                <i class="bi bi-sun-fill"></i> <span id="theme-switcher-text">Mudar Tema</span>
                            </a>
                        </li>
                        
                        {% if current_user.is_authenticated %}
                            <li class="nav-item d-lg-none" id="nav-user-separator"><hr></li>
                            <li class="nav-item d-lg-none" id="nav-user-logout">
                                <a class="nav-link" href="{{ url_for('logout') }}"><i class="bi bi-box-arrow-right"></i> Sair</a>
                            </li>
                        {% endif %}
                    </ul>
                </div>
            </div>
        </div>
    </nav>
    
    <div class="container mt-3">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>

    <main class="container my-5">
        {% block content %}{% endblock %}
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        /* [INÍCIO DO SCRIPT GLOBAL] */
        const themeSwitcher = document.getElementById('theme-switcher');
        const root = document.documentElement;

        // Função de toggle de tema
        if (themeSwitcher) {
            function toggleTheme() {
                const currentTheme = root.getAttribute('data-bs-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                
                root.setAttribute('data-bs-theme', newTheme);
                localStorage.setItem('theme', newTheme);

                // Atualiza o CSS customizado com a cor salva
                const preferredColor = localStorage.getItem('primaryColor') || '#0d6efd';
                window.applyAppTheme(preferredColor, newTheme); // Reutiliza a função do head
                updateThemeSwitcherText(newTheme);
            }
            
            function updateThemeSwitcherText(theme) {
                const textEl = document.getElementById('theme-switcher-text');
                const iconEl = themeSwitcher.querySelector('i');
                if (theme === 'dark') {
                    iconEl.className = 'bi bi-moon-fill';
                    textEl.textContent = 'Tema Claro';
                } else {
                    iconEl.className = 'bi bi-sun-fill';
                    textEl.textContent = 'Tema Escuro';
                }
            }
            
            themeSwitcher.addEventListener('click', toggleTheme);
            updateThemeSwitcherText(root.getAttribute('data-bs-theme'));
        }

        // Lógica para toggle de senha (olho)
        document.body.addEventListener('click', function(event) { 
            const button = event.target.closest('.toggle-password');
            if (button) {
                const targetId = button.getAttribute('data-target');
                const passwordInput = document.getElementById(targetId);
                const icon = button.querySelector('i');
                if (passwordInput && passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    icon.className = 'bi bi-eye-slash-fill';
                } else if (passwordInput) {
                    passwordInput.type = 'password';
                    icon.className = 'bi bi-eye-fill';
                }
            }
        });
        
        // Lógica do Componente _imageInput
        document.querySelectorAll('.image-input-container').forEach(container => {
            const input = container.querySelector('input[type="file"]');
            const preview = container.querySelector('.image-input-preview');
            const previewImg = container.querySelector('img');

            if (preview) {
                preview.addEventListener('click', () => input.click());
            }

            if (input) {
                input.addEventListener('change', function () {
                    const file = this.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            if (previewImg) {
                                previewImg.src = e.target.result;
                            }
                        }
                        reader.readAsDataURL(file);
                    }
                });
            }
        });
        
        // Lógica do Componente _regexText (simulação)
        document.querySelectorAll('input[data-regex]').forEach(input => {
            input.addEventListener('blur', function () {
                try {
                    const regex = new RegExp(this.getAttribute('data-regex'));
                    const condition = this.getAttribute('data-regex-condition');
                    let isValid = regex.test(this.value);
                    
                    if (condition === 'must-not-match') {
                        isValid = !isValid;
                    }

                    if (this.value && !isValid) {
                        this.classList.add('is-invalid');
                        this.setCustomValidity(this.getAttribute('data-regex-message') || 'Campo inválido.');
                    } else {
                        this.classList.remove('is-invalid');
                        this.setCustomValidity('');
                    }
                } catch (e) {
                    console.error("Erro na regex:", e);
                }
            });
        });
        /* [FIM DO SCRIPT GLOBAL] */
    </script>

    {% block extra_scripts %}{% endblock %}

</body>
</html>